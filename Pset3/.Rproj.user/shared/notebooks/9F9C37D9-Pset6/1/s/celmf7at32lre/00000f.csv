"0","#First, we assign the weights and difference in CATT (?) in one loop"
"0","w = list()"
"0","d = list()"
"0","for(s in 1:10){"
"0","  #set df to this stratum"
"0","  df <- psid_trimmed[psid_trimmed$stratum == s]"
"0","  #if treated AND control counts positive:"
"0","  if(nrow(df[df$treat==1]) >0"
"0","     & nrow(df[df$treat==0])>0"
"0","  ){"
"0","    #num of treated in each strata "
"0","    n <- nrow(df[df$treat == 1])"
"0","    w <- c(w, n)"
"0","    "
"0","    #Find avg treatment effect in stratum"
"0","    avg_t <- mean(df[df$treat == 1]$re78)"
"0","    avg_c <- mean(df[df$treat == 0]$re78)"
"0","    diff <- avg_t-avg_c"
"0","    d <- append(d, c(diff))"
"0","  }"
"0","}"
"0",""
"0","#make appended list ""normal"""
"0","d <- unlist(d)"
"0","w <- unlist(w)"
"0",""
"0","#normalize weight"
"0","w <- w/sum(w)"
"0",""
"0",""
"0","#Now for the estimator:"
"0","att <- weighted.mean(d, w)"
"0","att"
"1","[1]"
"1"," 1562.727"
"1","
"
