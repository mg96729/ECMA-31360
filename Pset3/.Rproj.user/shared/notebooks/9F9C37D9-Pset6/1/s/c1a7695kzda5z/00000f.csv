"0","# Declare a function that identifies perfectly collinear covariates."
"0","# Note: this fnc is roughly equivalent to _rmcoll in STATA."
"0","rmcoll <- function(df, colnames = names(df)) {"
"0","  # Arguments:"
"0","  # - df: A data frame."
"0","  # - colnames: A list of column names."
"0","  # Returns:"
"0","  # A list with the column names of collinear variables."
"0"," 	df_ <- df %>% dplyr::select(one_of(colnames))"
"0"," 	cc <- coef(lm(rep(1, nrow(df_)) ~ ., data = df_))"
"0","  	return(names(cc)[is.na(cc)])"
"0","} # end fnc rmcoll"
"0",""
"0","#listing OPVs"
"0","list_OPVs <- c('age', 'edu', 'married', 'black', 'hisp', 're74', 're75', 'u74black')"
"0",""
"0","#Now for each strata 1-10:"
"0","for(s in 1:10){"
"0","  #set df to this stratum"
"0","  df <- psid_trimmed[psid_trimmed$stratum == s]"
"0","  #if treated AND control counts positive:"
"0","  if(nrow(df[df$treat==1]) >0"
"0","     & nrow(df[df$treat==0])>0"
"0","  ){"
"0","    #get rid of colinear terms"
"0","    to_die <- rmcoll(df = df)"
"0","    list_survivors <- list_OPVs[!(list_OPVs %in% to_die)]"
"0","    #Now get formulas for SUR"
"0","    list_fo = list()"
"0","    for (x in list_survivors){"
"0","      xname = toString(x)"
"0","      fo <- as.formula(paste(xname, ""~treat""))"
"0","      list_fo <- append(list_fo, fo)"
"0","    }"
"0","    #Now use SUR estimation on this list of formulas"
"0","    sur_fit <- systemfit::systemfit(formula = list_fo, data=df, method=""SUR"")"
"0","    #Print summary"
"0","    print(paste('stratum:', s))"
"0","    print(summary(sur_fit)$coefficients)"
"0","    rm(sur_fit)"
"0","  }"
"0","}"
"1","[1]"
"1"," ""stratum: 1"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","      t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  3.142731e+01"
"1"," 2.987026e-01"
"1"," 105.21269648"
"1"," 0.000000e+00"
"1","
eq1_treat      "
"1"," -1.063672e+00"
"1"," 2.889019e+00"
"1","  -0.36817761"
"1"," 7.128167e-01"
"1","
eq2_(Intercept)"
"1","  1.122986e+01"
"1"," 8.211127e-02"
"1"," 136.76395722"
"1"," 0.000000e+00"
"1","
eq2_treat      "
"1","  3.155921e-01"
"1"," 7.941712e-01"
"1","   0.39738545"
"1"," 6.911658e-01"
"1","
eq3_(Intercept)"
"1","  8.280943e-01"
"1"," 1.183963e-02"
"1","  69.94259616"
"1"," 0.000000e+00"
"1","
eq3_treat      "
"1"," -9.912484e-03"
"1"," 1.145116e-01"
"1","  -0.08656316"
"1"," 9.310356e-01"
"1","
eq4_(Intercept)"
"1","  3.624754e-01"
"1"," 1.508133e-02"
"1","  24.03471984"
"1"," 0.000000e+00"
"1","
eq4_treat      "
"1","  2.738882e-01"
"1"," 1.458649e-01"
"1","   1.87768373"
"1"," 6.070766e-02"
"1","
eq5_(Intercept)"
"1","  4.911591e-02"
"1"," 6.743567e-03"
"1","   7.28337289"
"1"," 6.474821e-13"
"1","
eq5_treat      "
"1"," -4.911591e-02"
"1"," 6.522304e-02"
"1","  -0.75304547"
"1"," 4.515952e-01"
"1","
eq6_(Intercept)"
"1","  1.221653e+04"
"1"," 2.945914e+02"
"1","  41.46939437"
"1"," 0.000000e+00"
"1","
eq6_treat      "
"1"," -7.390745e+01"
"1"," 2.849256e+03"
"1","  -0.02593921"
"1"," 9.793109e-01"
"1","
eq7_(Intercept)"
"1","  1.035292e+04"
"1"," 2.598232e+02"
"1","  39.84603724"
"1"," 0.000000e+00"
"1","
eq7_treat      "
"1"," -1.388451e+03"
"1"," 2.512981e+03"
"1","  -0.55251149"
"1"," 5.807182e-01"
"1","
eq8_(Intercept)"
"1","  1.473477e-02"
"1"," 3.759786e-03"
"1","   3.91904621"
"1"," 9.478722e-05"
"1","
eq8_treat      "
"1"," -1.473477e-02"
"1"," 3.636423e-02"
"1","  -0.40519963"
"1"," 6.854152e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 2"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","    t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  2.803774e+01"
"1"," 1.095230e+00"
"1"," 25.5998551"
"1"," 0.000000e+00"
"1","
eq1_treat      "
"1","  6.765499e-01"
"1"," 3.206506e+00"
"1","  0.2109929"
"1"," 8.336324e-01"
"1","
eq2_(Intercept)"
"1","  1.043396e+01"
"1"," 3.188134e-01"
"1"," 32.7274907"
"1"," 0.000000e+00"
"1","
eq2_treat      "
"1","  2.803235e-01"
"1"," 9.333900e-01"
"1","  0.3003283"
"1"," 7.650006e-01"
"1","
eq3_(Intercept)"
"1","  5.660377e-01"
"1"," 6.718625e-02"
"1","  8.4249048"
"1"," 1.193090e-11"
"1","
eq3_treat      "
"1","  2.911051e-01"
"1"," 1.967012e-01"
"1","  1.4799357"
"1"," 1.443020e-01"
"1","
eq4_(Intercept)"
"1","  6.037736e-01"
"1"," 6.842767e-02"
"1","  8.8235300"
"1"," 2.595701e-12"
"1","
eq4_treat      "
"1"," -3.234501e-02"
"1"," 2.003357e-01"
"1"," -0.1614541"
"1"," 8.722969e-01"
"1","
eq5_(Intercept)"
"1","  7.547170e-02"
"1"," 4.083818e-02"
"1","  1.8480672"
"1"," 6.969332e-02"
"1","
eq5_treat      "
"1","  2.102426e-01"
"1"," 1.195619e-01"
"1","  1.7584407"
"1"," 8.394786e-02"
"1","
eq6_(Intercept)"
"1","  5.989884e+03"
"1"," 7.517096e+02"
"1","  7.9683489"
"1"," 6.920553e-11"
"1","
eq6_treat      "
"1"," -3.958227e+03"
"1"," 2.200780e+03"
"1"," -1.7985562"
"1"," 7.729305e-02"
"1","
eq7_(Intercept)"
"1","  3.916448e+03"
"1"," 4.851172e+02"
"1","  8.0731998"
"1"," 4.617906e-11"
"1","
eq7_treat      "
"1"," -6.664367e+02"
"1"," 1.420278e+03"
"1"," -0.4692298"
"1"," 6.406645e-01"
"1","
eq8_(Intercept)"
"1","  5.660377e-02"
"1"," 3.463412e-02"
"1","  1.6343355"
"1"," 1.076053e-01"
"1","
eq8_treat      "
"1","  8.625337e-02"
"1"," 1.013983e-01"
"1","  0.8506390"
"1"," 3.984681e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 3"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","     t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  2.783333e+01"
"1"," 1.780308e+00"
"1"," 15.63399537"
"1"," 0.000000e+00"
"1","
eq1_treat      "
"1","  7.575758e-02"
"1"," 3.175652e+00"
"1","  0.02385575"
"1"," 9.811113e-01"
"1","
eq2_(Intercept)"
"1","  1.058333e+01"
"1"," 5.359190e-01"
"1"," 19.74800785"
"1"," 0.000000e+00"
"1","
eq2_treat      "
"1"," -4.015152e-01"
"1"," 9.559537e-01"
"1"," -0.42001527"
"1"," 6.771965e-01"
"1","
eq3_(Intercept)"
"1","  2.916667e-01"
"1"," 9.125041e-02"
"1","  3.19633262"
"1"," 3.062546e-03"
"1","
eq3_treat      "
"1"," -1.098485e-01"
"1"," 1.627693e-01"
"1"," -0.67487223"
"1"," 5.044582e-01"
"1","
eq4_(Intercept)"
"1","  6.666667e-01"
"1"," 1.008838e-01"
"1","  6.60826550"
"1"," 1.628960e-07"
"1","
eq4_treat      "
"1"," -1.212121e-01"
"1"," 1.799529e-01"
"1"," -0.67357679"
"1"," 5.052711e-01"
"1","
eq5_(Intercept)"
"1","  8.333333e-02"
"1"," 4.811252e-02"
"1","  1.73205081"
"1"," 9.260369e-02"
"1","
eq5_treat      "
"1"," -8.333333e-02"
"1"," 8.582144e-02"
"1"," -0.97100831"
"1"," 3.386079e-01"
"1","
eq6_(Intercept)"
"1","  6.476191e+03"
"1"," 1.309017e+03"
"1","  4.94737086"
"1"," 2.153903e-05"
"1","
eq6_treat      "
"1"," -5.914572e+02"
"1"," 2.334978e+03"
"1"," -0.25330307"
"1"," 8.016054e-01"
"1","
eq7_(Intercept)"
"1","  2.417831e+03"
"1"," 5.528861e+02"
"1","  4.37310980"
"1"," 1.153742e-04"
"1","
eq7_treat      "
"1","  2.764310e+02"
"1"," 9.862189e+02"
"1","  0.28029378"
"1"," 7.810018e-01"
"1","
eq8_(Intercept)"
"1","  8.333333e-02"
"1"," 5.884434e-02"
"1","  1.41616555"
"1"," 1.660974e-01"
"1","
eq8_treat      "
"1","  7.575758e-03"
"1"," 1.049645e-01"
"1","  0.07217448"
"1"," 9.428987e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 4"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","     t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  2.752941e+01"
"1"," 2.190732e+00"
"1"," 12.56630576"
"1"," 1.054712e-13"
"1","
eq1_treat      "
"1","  7.205882e-01"
"1"," 3.146200e+00"
"1","  0.22903449"
"1"," 8.203464e-01"
"1","
eq2_(Intercept)"
"1","  1.064706e+01"
"1"," 4.585677e-01"
"1"," 23.21807321"
"1"," 0.000000e+00"
"1","
eq2_treat      "
"1"," -5.845588e-01"
"1"," 6.585677e-01"
"1"," -0.88762140"
"1"," 3.815797e-01"
"1","
eq3_(Intercept)"
"1","  2.352941e-01"
"1"," 1.072232e-01"
"1","  2.19443250"
"1"," 3.582339e-02"
"1","
eq3_treat      "
"1","  1.470588e-02"
"1"," 1.539876e-01"
"1","  0.09550042"
"1"," 9.245320e-01"
"1","
eq4_(Intercept)"
"1","  8.823529e-01"
"1"," 8.166561e-02"
"1"," 10.80446212"
"1"," 4.892309e-12"
"1","
eq4_treat      "
"1"," -7.352941e-03"
"1"," 1.172833e-01"
"1"," -0.06269385"
"1"," 9.504128e-01"
"1","
eq5_(Intercept)"
"1","  4.790868e+03"
"1"," 1.301647e+03"
"1","  3.68061991"
"1"," 8.797585e-04"
"1","
eq5_treat      "
"1","  1.042220e+02"
"1"," 1.869348e+03"
"1","  0.05575315"
"1"," 9.558963e-01"
"1","
eq6_(Intercept)"
"1","  3.134960e+03"
"1"," 6.371173e+02"
"1","  4.92053776"
"1"," 2.696792e-05"
"1","
eq6_treat      "
"1"," -2.293450e+02"
"1"," 9.149901e+02"
"1"," -0.25065294"
"1"," 8.037363e-01"
"1","
eq7_(Intercept)"
"1","  1.764706e-01"
"1"," 9.650524e-02"
"1","  1.82861156"
"1"," 7.709417e-02"
"1","
eq7_treat      "
"1","  1.102941e-02"
"1"," 1.385951e-01"
"1","  0.07958010"
"1"," 9.370827e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 5"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","       t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  2.887500e+01"
"1"," 3.329747e+00"
"1","  8.671830e+00"
"1"," 3.010287e-06"
"1","
eq1_treat      "
"1"," -1.075000e+00"
"1"," 5.369056e+00"
"1"," -2.002214e-01"
"1"," 8.449610e-01"
"1","
eq2_(Intercept)"
"1","  1.062500e+01"
"1"," 8.599353e-01"
"1","  1.235558e+01"
"1"," 8.611639e-08"
"1","
eq2_treat      "
"1"," -1.225000e+00"
"1"," 1.386604e+00"
"1"," -8.834534e-01"
"1"," 3.958893e-01"
"1","
eq3_(Intercept)"
"1","  2.500000e-01"
"1"," 1.305582e-01"
"1","  1.914854e+00"
"1"," 8.186423e-02"
"1","
eq3_treat      "
"1"," -2.500000e-01"
"1"," 2.105188e-01"
"1"," -1.187542e+00"
"1"," 2.600246e-01"
"1","
eq4_(Intercept)"
"1","  1.000000e+00"
"1"," 1.167748e-01"
"1","  8.563488e+00"
"1"," 3.400205e-06"
"1","
eq4_treat      "
"1"," -6.000000e-01"
"1"," 1.882938e-01"
"1"," -3.186510e+00"
"1"," 8.660183e-03"
"1","
eq5_(Intercept)"
"1"," -6.427538e-16"
"1"," 9.534626e-02"
"1"," -6.741259e-15"
"1"," 1.000000e+00"
"1","
eq5_treat      "
"1","  2.000000e-01"
"1"," 1.537412e-01"
"1","  1.300887e+00"
"1"," 2.198878e-01"
"1","
eq6_(Intercept)"
"1","  2.375366e+03"
"1"," 1.799947e+03"
"1","  1.319687e+00"
"1"," 2.137457e-01"
"1","
eq6_treat      "
"1","  3.340514e+03"
"1"," 2.902327e+03"
"1","  1.150978e+00"
"1"," 2.741463e-01"
"1","
eq7_(Intercept)"
"1","  3.204679e+03"
"1"," 8.124514e+02"
"1","  3.944456e+00"
"1"," 2.294418e-03"
"1","
eq7_treat      "
"1"," -1.287417e+03"
"1"," 1.310039e+03"
"1"," -9.827321e-01"
"1"," 3.468606e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 6"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","    t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  2.500000e+01"
"1","    2.9343698"
"1","  8.5197168"
"1"," 6.499387e-08"
"1","
eq1_treat      "
"1"," -1.600000e+00"
"1","    3.4719932"
"1"," -0.4608304"
"1"," 6.501515e-01"
"1","
eq2_(Intercept)"
"1","  9.333333e+00"
"1","    0.7738413"
"1"," 12.0610427"
"1"," 2.377996e-10"
"1","
eq2_treat      "
"1","  7.333333e-01"
"1","    0.9156214"
"1","  0.8009133"
"1"," 4.330837e-01"
"1","
eq3_(Intercept)"
"1","  1.666667e-01"
"1","    0.1244873"
"1","  1.3388252"
"1"," 1.964272e-01"
"1","
eq3_treat      "
"1"," -1.000000e-01"
"1","    0.1472953"
"1"," -0.6789083"
"1"," 5.053825e-01"
"1","
eq4_(Intercept)"
"1","  8.333333e-01"
"1","    0.1972027"
"1","  4.2257713"
"1"," 4.576102e-04"
"1","
eq4_treat      "
"1"," -2.333333e-01"
"1","    0.2333333"
"1"," -1.0000000"
"1"," 3.298768e-01"
"1","
eq5_(Intercept)"
"1","  1.666667e-01"
"1","    0.1500487"
"1","  1.1107503"
"1"," 2.805353e-01"
"1","
eq5_treat      "
"1"," -3.333333e-02"
"1","    0.1775400"
"1"," -0.1877511"
"1"," 8.530624e-01"
"1","
eq6_(Intercept)"
"1","  3.173687e+03"
"1"," 1213.1380722"
"1","  2.6160969"
"1"," 1.699093e-02"
"1","
eq6_treat      "
"1"," -7.707301e+02"
"1"," 1435.4043246"
"1"," -0.5369428"
"1"," 5.975394e-01"
"1","
eq7_(Intercept)"
"1","  2.878540e+03"
"1","  963.2564393"
"1","  2.9883423"
"1"," 7.554135e-03"
"1","
eq7_treat      "
"1"," -1.147385e+03"
"1"," 1139.7403893"
"1"," -1.0067070"
"1"," 3.267252e-01"
"1","
eq8_(Intercept)"
"1","  1.666667e-01"
"1","    0.1244873"
"1","  1.3388252"
"1"," 1.964272e-01"
"1","
eq8_treat      "
"1"," -1.000000e-01"
"1","    0.1472953"
"1"," -0.6789083"
"1"," 5.053825e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 7"""
"1","
"
"1","               "
"1","      Estimate"
"1","   Std. Error"
"1","    t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","   24.87500000"
"1","    2.4626903"
"1"," 10.1007421"
"1"," 2.672311e-09"
"1","
eq1_treat      "
"1","   -0.37500000"
"1","    3.0871457"
"1"," -0.1214714"
"1"," 9.045298e-01"
"1","
eq2_(Intercept)"
"1","    9.87500000"
"1","    0.8580631"
"1"," 11.5084773"
"1"," 2.836402e-10"
"1","
eq2_treat      "
"1","    1.19642857"
"1","    1.0756390"
"1","  1.1122956"
"1"," 2.792028e-01"
"1","
eq3_(Intercept)"
"1","    0.12500000"
"1","    0.1061712"
"1","  1.1773439"
"1"," 2.528796e-01"
"1","
eq3_treat      "
"1","   -0.05357143"
"1","    0.1330926"
"1"," -0.4025124"
"1"," 6.915767e-01"
"1","
eq4_(Intercept)"
"1","    0.87500000"
"1","    0.1061712"
"1","  8.2414072"
"1"," 7.341425e-08"
"1","
eq4_treat      "
"1","    0.05357143"
"1","    0.1330926"
"1","  0.4025124"
"1"," 6.915767e-01"
"1","
eq5_(Intercept)"
"1"," 1533.12586212"
"1","  803.3937028"
"1","  1.9083120"
"1"," 7.080955e-02"
"1","
eq5_treat      "
"1","  736.04129573"
"1"," 1007.1073044"
"1","  0.7308469"
"1"," 4.733485e-01"
"1","
eq6_(Intercept)"
"1","  643.84411430"
"1","  446.0506517"
"1","  1.4434327"
"1"," 1.643803e-01"
"1","
eq6_treat      "
"1","  586.66101810"
"1","  559.1540834"
"1","  1.0491938"
"1"," 3.066027e-01"
"1","
eq7_(Intercept)"
"1","    0.12500000"
"1","    0.1421298"
"1","  0.8794775"
"1"," 3.895875e-01"
"1","
eq7_treat      "
"1","    0.08928571"
"1","    0.1781692"
"1","  0.5011288"
"1"," 6.217514e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 8"""
"1","
"
"1","               "
"1","  Estimate"
"1","   Std. Error"
"1","    t value"
"1","     Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","    24.800"
"1","    2.9007836"
"1","  8.5494140"
"1"," 3.454730e-06"
"1","
eq1_treat      "
"1","     7.200"
"1","    3.6977880"
"1","  1.9471100"
"1"," 7.749806e-02"
"1","
eq2_(Intercept)"
"1","    10.800"
"1","    0.3384456"
"1"," 31.9105894"
"1"," 3.404610e-12"
"1","
eq2_treat      "
"1","     0.450"
"1","    0.4314352"
"1","  1.0430302"
"1"," 3.193155e-01"
"1","
eq3_(Intercept)"
"1","     0.200"
"1","    0.2205365"
"1","  0.9068792"
"1"," 3.839067e-01"
"1","
eq3_treat      "
"1","     0.425"
"1","    0.2811300"
"1","  1.5117560"
"1"," 1.587800e-01"
"1","
eq4_(Intercept)"
"1","     0.800"
"1","    0.1206045"
"1","  6.6332496"
"1"," 3.693776e-05"
"1","
eq4_treat      "
"1","     0.200"
"1","    0.1537412"
"1","  1.3008873"
"1"," 2.198878e-01"
"1","
eq5_(Intercept)"
"1","  1567.414"
"1","  416.0428890"
"1","  3.7674337"
"1"," 3.114223e-03"
"1","
eq5_treat      "
"1"," -1567.414"
"1","  530.3527024"
"1"," -2.9554182"
"1"," 1.308203e-02"
"1","
eq6_(Intercept)"
"1","  2539.034"
"1"," 1509.6643619"
"1","  1.6818531"
"1"," 1.207349e-01"
"1","
eq6_treat      "
"1"," -1037.106"
"1"," 1924.4520101"
"1"," -0.5389099"
"1"," 6.006855e-01"
"1","
"
"1","[1]"
"1"," ""stratum: 10"""
"1","
"
"1","               "
"1","     Estimate"
"1","   Std. Error"
"1","     t value"
"1","  Pr(>|t|)"
"1","
eq1_(Intercept)"
"1","  23.28571429"
"1","   1.86344307"
"1"," 12.49606960"
"1"," 0.0000000"
"1","
eq1_treat      "
"1","   0.08137432"
"1","   1.94424866"
"1","  0.04185387"
"1"," 0.9667145"
"1","
eq2_(Intercept)"
"1","  10.57142857"
"1","   0.69323142"
"1"," 15.24949423"
"1"," 0.0000000"
"1","
eq2_treat      "
"1","  -0.40687161"
"1","   0.72329243"
"1"," -0.56252712"
"1"," 0.5752551"
"1","
eq3_(Intercept)"
"1","   1.00000000"
"1","   0.08036342"
"1"," 12.44347218"
"1"," 0.0000000"
"1","
eq3_treat      "
"1","  -0.05063291"
"1","   0.08384827"
"1"," -0.60386353"
"1"," 0.5475617"
"1","
eq4_(Intercept)"
"1"," 127.88014439"
"1"," 284.84597799"
"1","  0.44894488"
"1"," 0.6546275"
"1","
eq4_treat      "
"1"," 106.59136339"
"1"," 297.19792410"
"1","  0.35865447"
"1"," 0.7207534"
"1","
"
